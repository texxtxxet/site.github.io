<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ãƒ‰ãƒªãƒ«</title>
  <style>
    :root {
      --bg: #0b1020;      /* èƒŒæ™¯è‰²ã‚’ä¸€è‰²ã«çµ±ä¸€ï¼ˆå¿…è¦ãªã‚‰å¤‰æ›´OKï¼‰ */
      --card: #121a33;
      --muted: #96a0c6;
      --text: #e8edff;
      --accent: #8fb3ff;
      --ok: #2ecc71;
      --ng: #ff6b6b;
      --warn: #ffb86b;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg); /* å˜è‰²èƒŒæ™¯ */
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", Meiryo, sans-serif;
      line-height: 1.5;
    }
    header { padding: 20px; text-align: center; }
    header h1 { margin: 0 0 6px; font-size: 24px; letter-spacing: .03em; }
    header p { margin: 0; color: var(--muted); font-size: 14px; }

    .wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px;
      display: grid;
      gap: 16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 768px) {
      .wrap { grid-template-columns: 320px 1fr; }
    }

    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.01));
      border: 1px solid rgba(255,255,255,.08);
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
      border-radius: 16px;
      overflow: hidden;
    }
    .card h2 { margin: 0; font-size: 16px; padding: 14px 16px; background: rgba(255,255,255,.04); border-bottom: 1px solid rgba(255,255,255,.08); }
    .card .body { padding: 14px; }

    select, button, .pill {
      appearance: none;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 14px;
    }

    /* ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã®è¦‹ã‚„ã™ã•ä¿®æ­£ */
    select {
      width: 100%;
      color: #000;            /* é»’æ–‡å­— */
      background: #fff;       /* ç™½èƒŒæ™¯ */
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    button {
      cursor: pointer;
      transition: transform .05s ease, background .15s ease, border-color .15s;
    }
    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); }

    .toolbar { display: flex; flex-direction: column; gap: 10px; }
    .btn-row { display: flex; flex-direction: column; gap: 8px; }
    @media (min-width: 520px) {
      .btn-row { flex-direction: row; flex-wrap: wrap; }
    }

    .options { display: flex; flex-wrap: wrap; gap: 8px; }
    .pill { user-select: none; cursor: pointer; }
    .pill[disabled] { opacity: .35; cursor: not-allowed; }

    .stack {
      min-height: 400px; display: flex; flex-direction: column; gap: 10px; justify-content: flex-start; align-items: stretch;
      background: repeating-linear-gradient(180deg, rgba(255,255,255,.02) 0 8px, rgba(255,255,255,.01) 8px 16px);
      border: 1px dashed rgba(255,255,255,.18); border-radius: 16px; padding: 16px; position: relative;
    }
    .stack::before, .stack::after {
      position: absolute; left: 12px; color: var(--muted); font-size: 12px; letter-spacing: .04em;
    }
    .stack::before { content: "TOP"; top: 8px; }
    .stack::after { content: "BOTTOM"; bottom: 8px; }

    .layer { padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.18); background: rgba(255,255,255,.07); display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .layer small { color: var(--muted); }

    .layer.ok { border-color: rgba(46,204,113,.6); box-shadow: 0 0 0 2px rgba(46,204,113,.15) inset; }
    .layer.ng { border-color: rgba(255,107,107,.6); box-shadow: 0 0 0 2px rgba(255,107,107,.12) inset; }

    .status { font-size: 14px; padding: 12px; border-radius: 12px; }
    .status.ok { background: rgba(46,204,113,.12); border: 1px solid rgba(46,204,113,.35); }
    .status.ng { background: rgba(255,107,107,.12); border: 1px solid rgba(255,107,107,.35); }
    .status.hint { background: rgba(255,184,107,.12); border: 1px solid rgba(255,184,107,.35); }

    .kbd { padding: 2px 6px; border-radius: 6px; border: 1px solid rgba(255,255,255,.2); font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background: rgba(255,255,255,.06); font-size: 12px; }

    .flex { display: flex; gap: 8px; align-items: center; }
    .space { height: 6px; }
  </style>
</head>
<body>

<main class="wrap">
  <section class="card">
    <h2>ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼ é¸æŠãƒ»æ“ä½œ</h2>
    <div class="body">
      <div class="toolbar">
        <label>
          <span class="space"></span>
          <select id="burgerSelect" aria-label="ãƒãƒ¼ã‚¬ãƒ¼ã‚’é¸æŠ">
            <!-- options injected -->
          </select>
        </label>
        <div class="btn-row">
          <button id="btnCheck">ãƒã‚§ãƒƒã‚¯</button>
          <button id="btnUndo">ä¸€æ‰‹æˆ»ã™</button>
          <button id="btnReset">ãƒªã‚»ãƒƒãƒˆ</button>
        </div>
        <div class="btn-row">
          <button id="btnHint">ãƒ’ãƒ³ãƒˆï¼ˆæ¬¡ã®æ­£è§£ã‚’ç¤ºã™ï¼‰</button>
          <button id="btnAuto">è‡ªå‹•é…ç½®</button>
          <button id="btnReveal">æ­£è§£ã‚’è¡¨ç¤ºï¼éè¡¨ç¤º</button>
        </div>
      </div>
    </div>
  </section>

  <section class="card">
    <h2>é¸æŠè‚¢ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§è¿½åŠ ï¼‰</h2>
    <div class="body">
      <div id="options" class="options" aria-live="polite"></div>
    </div>
  </section>

  <section class="card" style="grid-column: 1 / -1;">
    <h2>ã‚ãªãŸã®ã‚¹ã‚¿ãƒƒã‚¯</h2>
    <div class="body">
      <div id="stack" class="stack" aria-live="polite"></div>
      <div id="status" class="status hint" style="margin-top: 12px;">ãƒãƒ¼ã‚¬ãƒ¼ã‚’é¸ã‚“ã§ã€ä¸Šã‹ã‚‰é †ã«ç½®ã„ã¦ã„ã“ã†ã€‚</div>
    </div>
  </section>
</main>

<script>
  // ====== ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆä¸Šâ†’ä¸‹ã®é †ï¼‰ ======
  const BURGERS = {
    "ãƒãƒ³ãƒãƒ¼ã‚¬ãƒ¼": [
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚±ãƒãƒ£ãƒƒãƒ—",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ”ã‚¯ãƒ«ã‚¹",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼": [
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚±ãƒãƒ£ãƒƒãƒ—",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ”ã‚¯ãƒ«ã‚¹",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒãƒƒã‚¯ãƒã‚­ãƒ³": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¹ã‚¤ãƒ¼ãƒˆãƒ¬ãƒ¢ãƒ³ã‚½ãƒ¼ã‚¹",
      "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ‰ãƒ¬ã‚¿ã‚¹",
      "ãƒãƒƒã‚¯ãƒã‚­ãƒ³ãƒ‘ãƒ†ã‚£",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ã‚¹ãƒ‘ãƒã‚­ï¼ˆã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ãƒãƒƒã‚¯ãƒã‚­ãƒ³ï¼‰": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¹ãƒ‘ã‚¤ã‚·ãƒ¼ã‚½ãƒ¼ã‚¹",
      "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ‰ãƒ¬ã‚¿ã‚¹",
      "ãƒãƒƒã‚¯ãƒã‚­ãƒ³ãƒ‘ãƒ†ã‚£",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒã‚­ãƒãƒ¼ï¼ˆãƒãƒƒã‚¯ãƒã‚­ãƒ³ãƒãƒ¼ã‚ºï¼‰": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¹ã‚¤ãƒ¼ãƒˆãƒ¬ãƒ¢ãƒ³ã‚½ãƒ¼ã‚¹",
      "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ‰ãƒ¬ã‚¿ã‚¹",
      "ãƒãƒƒã‚¯ãƒã‚­ãƒ³ãƒ‘ãƒ†ã‚£",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ã‚¨ã‚°ãƒï¼ˆã‚¨ãƒƒã‚°ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼ï¼‰": [
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚±ãƒãƒ£ãƒƒãƒ—",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ”ã‚¯ãƒ«ã‚¹",
      "ã‚¨ãƒƒã‚°",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒ•ã‚£ãƒ¬ã‚ªãƒ•ã‚£ãƒƒã‚·ãƒ¥": [
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¿ãƒ«ã‚¿ãƒ«ã‚½ãƒ¼ã‚¹",
      "ãƒ•ã‚£ãƒƒã‚·ãƒ¥ãƒãƒ¼ã‚·ãƒ§ãƒ³",
      "ãƒãƒ¼ãƒ•ãƒãƒ¼ã‚º",
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ã¦ã‚Šã‚„ããƒãƒƒã‚¯ãƒãƒ¼ã‚¬ãƒ¼": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¹ã‚¤ãƒ¼ãƒˆãƒ¬ãƒ¢ãƒ³ã‚½ãƒ¼ã‚¹",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ã¦ã‚Šã‚„ããƒ‘ãƒ†ã‚£",
      "ã¦ã‚Šã‚„ãã‚½ãƒ¼ã‚¹",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒ™ãƒ¼ã‚³ãƒ³ãƒ¬ã‚¿ã‚¹ãƒãƒ¼ã‚¬ãƒ¼": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¤ã‚¨ãƒ­ãƒ¼ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ™ãƒ¼ã‚³ãƒ³",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒã‚­ãƒ³ãƒ•ã‚£ãƒ¬ã‚ª": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚ªãƒ¼ãƒ­ãƒ©ã‚½ãƒ¼ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ãƒã‚­ãƒ³ãƒ‘ãƒ†ã‚£",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ã¦ã‚Šã‚„ããƒã‚­ãƒ³ãƒ•ã‚£ãƒ¬ã‚ª": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚¹ã‚¤ãƒ¼ãƒˆãƒ¬ãƒ¢ãƒ³ã‚½ãƒ¼ã‚¹",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ãƒã‚­ãƒ³ãƒ‘ãƒ†ã‚£",
      "ã¦ã‚Šã‚„ãã‚½ãƒ¼ã‚¹",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãˆã³ãƒ•ã‚£ãƒ¬ã‚ª": [
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ã‚ªãƒ¼ãƒ­ãƒ©ã‚½ãƒ¼ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ã‚·ãƒ¥ãƒªãƒ³ãƒ—ãƒãƒ¼ã‚·ãƒ§ãƒ³",
      "ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚»ã‚µãƒŸãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒ€ãƒ–ãƒ«ãƒãƒ¼ã‚ºãƒãƒ¼ã‚¬ãƒ¼": [
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ãƒã‚¹ã‚¿ãƒ¼ãƒ‰",
      "ã‚±ãƒãƒ£ãƒƒãƒ—",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ”ã‚¯ãƒ«ã‚¹ï¼ˆ2æšï¼‰",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯": [
      "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ãƒ”ã‚¯ãƒ«ã‚¹ï¼ˆ2æšï¼‰",
      "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ‰ãƒ¬ã‚¿ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ã‚½ãƒ¼ã‚¹",
      "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ãƒ–ï¼‰",
      "10:1ãƒ‘ãƒ†ã‚£",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "ã‚·ãƒ¥ãƒ¬ãƒƒãƒ‰ãƒ¬ã‚¿ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ã‚½ãƒ¼ã‚¹",
      "ãƒ“ãƒƒã‚°ãƒãƒƒã‚¯ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ç‚™ã‚Šé†¤æ²¹é¢¨ ãŸã¾ã”ãƒ™ãƒ¼ã‚³ãƒ³è‚‰åšãƒ“ãƒ¼ãƒ•": [
      "ãƒãƒ”ãƒ¼ã‚·ãƒ¼ãƒ‰ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ç‚™ã‚Šé†¤æ²¹é¢¨ã‚½ãƒ¼ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒ¬ã‚¿ã‚¹",
      "ã‚¹ãƒ¢ãƒ¼ã‚¯ãƒ™ãƒ¼ã‚³ãƒ³",
      "ã‚¨ãƒƒã‚°",
      "6:1ãƒ‘ãƒ†ã‚£",
      "ãƒ›ãƒ¯ã‚¤ãƒˆãƒã‚§ãƒ€ãƒ¼ãƒãƒ¼ã‚º",
      "ç‚™ã‚Šé†¤æ²¹é¢¨ã‚½ãƒ¼ã‚¹",
      "ãƒãƒ”ãƒ¼ã‚·ãƒ¼ãƒ‰ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ],
    "ç‚™ã‚Šé†¤æ²¹é¢¨ ãƒ€ãƒ–ãƒ«è‚‰åšãƒ“ãƒ¼ãƒ•": [
      "ãƒãƒ”ãƒ¼ã‚·ãƒ¼ãƒ‰ãƒãƒ³ã‚ºï¼ˆã‚¯ãƒ©ã‚¦ãƒ³ï¼‰",
      "ç‚™ã‚Šé†¤æ²¹é¢¨ã‚½ãƒ¼ã‚¹",
      "ã‚ªãƒ‹ã‚ªãƒ³",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "6:1ãƒ‘ãƒ†ã‚£",
      "ã‚¹ãƒ©ã‚¤ã‚¹ãƒãƒ¼ã‚º",
      "6:1ãƒ‘ãƒ†ã‚£",
      "ç‚™ã‚Šé†¤æ²¹é¢¨ã‚½ãƒ¼ã‚¹",
      "ãƒãƒ”ãƒ¼ã‚·ãƒ¼ãƒ‰ãƒãƒ³ã‚ºï¼ˆãƒ’ãƒ¼ãƒ«ï¼‰"
    ]
  };

// ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
const $ = (sel) => document.querySelector(sel);
const $$ = (sel) => Array.from(document.querySelectorAll(sel));
const shuffle = (arr) => arr.map(v=>[Math.random(), v]).sort((a,b)=>a[0]-b[0]).map(([,v])=>v);

// ====== çŠ¶æ…‹ ======
let currentKey = Object.keys(BURGERS)[0];
let target = [...BURGERS[currentKey]];
let stack = [];
let reveal = false;

// ====== åˆæœŸåŒ– ======
function initSelect() {
  const sel = $('#burgerSelect');
  sel.innerHTML = Object.keys(BURGERS).map(k => `<option value="${k}">${k}</option>`).join('');
  sel.value = currentKey;
  sel.addEventListener('change', () => {
    currentKey = sel.value;
    loadBurger(currentKey);
  });
}

// ====== ãƒãƒ¼ã‚¬ãƒ¼èª­ã¿è¾¼ã¿ ======
function loadBurger(key) {
  target = [...BURGERS[key]];          // ä¸Šâ†’ä¸‹ã®é †
  stack = [];
  reveal = false;
  renderOptions();
  renderStack();
  setStatus('ãƒãƒ¼ã‚¬ãƒ¼ã‚’é¸ã‚“ã§ã€ä¸Šã‹ã‚‰é †ã«ç½®ã„ã¦ã„ã“ã†ã€‚', 'hint');
}

// ====== é¸æŠè‚¢ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ======
function renderOptions() {
  const box = $('#options');
  box.innerHTML = '';

  // å…·æã”ã¨ã®å¿…è¦æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
  const counts = {};
  target.forEach(label => counts[label] = (counts[label] || 0) + 1);

  Object.keys(counts).forEach(label => {
    const maxCount = counts[label];                 // å¿…è¦æ•°
    const usedCount = stack.filter(v => v === label).length; // æ—¢ã«ç½®ã„ãŸæ•°
    const remaining = maxCount - usedCount;

    for (let i = 0; i < remaining; i++) {
      const btn = document.createElement('button');
      btn.className = 'pill';
      btn.textContent = label;
      btn.addEventListener('click', () => addLayer(label));
      box.appendChild(btn);
    }
  });
}

// ====== ã‚¹ã‚¿ãƒƒã‚¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° ======
function renderStack(mark = []) {
  const s = $('#stack');
  s.innerHTML = '';
  stack.forEach((label, i) => {
    const row = document.createElement('div');
    row.className = 'layer';
    if (mark[i] === true) row.classList.add('ok');
    if (mark[i] === false) row.classList.add('ng');

    const left = document.createElement('div');
    left.textContent = label;

    const right = document.createElement('div');
    right.className = 'flex';
    const idx = document.createElement('small');
    idx.textContent = `${i+1}/${target.length}`;
    const del = document.createElement('button');
    del.textContent = 'Ã—';
    del.addEventListener('click', () => removeAt(i));
    right.append(idx, del);

    row.append(left, right);
    s.appendChild(row);
  });

  if (reveal) {
    target.forEach((label, i) => {
      if (i >= stack.length) {
        const ghost = document.createElement('div');
        ghost.className = 'layer';
        ghost.style.opacity = .45;
        ghost.innerHTML = `<span>${label}</span><small>${i+1}/${target.length}</small>`;
        s.appendChild(ghost);
      }
    });
  }
}

// ====== æ“ä½œ ======
function addLayer(label) {
  stack.push(label);
  renderOptions();
  renderStack();
}
function removeAt(index) {
  stack.splice(index, 1);
  renderOptions();
  renderStack();
}
function undo() {
  stack.pop();
  renderOptions();
  renderStack();
}
function resetAll() { loadBurger(currentKey); }

// ====== ãƒã‚§ãƒƒã‚¯ ======
function check() {
  if (stack.length === 0) {
    setStatus('ã¾ãšã¯1æšç½®ã„ã¦ã¿ã‚ˆã†ï¼', 'hint');
    return;
  }
  const marks = stack.map((v, i) => v === target[i]);
  renderStack(marks);
  const allPlaced = stack.length === target.length;
  const allCorrect = marks.every(Boolean) && allPlaced;
  if (allCorrect) {
    setStatus('ğŸ‰ æ­£è§£ï¼å®Œç’§ãªé‡ã­æ–¹ï¼', 'ok');
  } else if (!allPlaced) {
    const nextNeed = target[stack.length];
    setStatus(`ã¾ã é€”ä¸­ã€‚æ¬¡ã¯ <b>${nextNeed}</b>`, 'hint');
  } else {
    setStatus(`é †ç•ªé•ã„ãŒã‚ã‚‹ã‚ˆã€‚`, 'ng');
  }
}

// ====== ãƒ’ãƒ³ãƒˆãƒ»è‡ªå‹•é…ç½® ======
function hint() {
  const idx = stack.length;
  if (idx >= target.length) { setStatus('å…¨ã¦é…ç½®æ¸ˆã¿ã€‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã­ã€‚', 'hint'); return; }
  const next = target[idx];
  highlightOption(next);
  setStatus(`ãƒ’ãƒ³ãƒˆï¼šæ¬¡ã¯ <b>${next}</b>`, 'hint');
}

function autoPlaceOne() {
  const idx = stack.length;
  if (idx >= target.length) return;
  const next = target[idx];
  addLayer(next);
  setStatus(`1æšè‡ªå‹•é…ç½®ï¼š<b>${next}</b>`, 'hint');
}

function toggleReveal() {
  reveal = !reveal;
  renderStack();
  setStatus(reveal ? 'æ­£è§£ã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºä¸­' : 'æ­£è§£ã‚¬ã‚¤ãƒ‰ã‚’éè¡¨ç¤º', 'hint');
}

function highlightOption(text) {
  $$('#options .pill').forEach(el => {
    el.style.outline = (el.textContent === text) ? '2px solid var(--warn)' : 'none';
  });
  setTimeout(() => $$('#options .pill').forEach(el => el.style.outline = 'none'), 1600);
}

// ====== ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ======
function setStatus(html, kind='hint') {
  const box = $('#status');
  box.className = `status ${kind}`;
  box.innerHTML = html;
}

// ====== ãƒœã‚¿ãƒ³ãƒã‚¤ãƒ³ãƒ‰ ======
function bind() {
  $('#btnCheck').addEventListener('click', check);
  $('#btnUndo').addEventListener('click', undo);
  $('#btnReset').addEventListener('click', resetAll);
  $('#btnHint').addEventListener('click', hint);
  $('#btnAuto').addEventListener('click', autoPlaceOne);
  $('#btnReveal').addEventListener('click', toggleReveal);
}

// ====== åˆæœŸåŒ– ======
initSelect();
bind();
loadBurger(currentKey);
</script>
</body>
</html>
